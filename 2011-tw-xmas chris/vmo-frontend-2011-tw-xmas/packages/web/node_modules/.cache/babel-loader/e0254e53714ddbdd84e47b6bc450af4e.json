{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nvar _jsxFileName = \"D:\\\\17\\u5C08\\u6848\\\\\\u5BA2\\u88FD\\u5316ui\\u5C08\\u6848\\\\2011-tw-xmas chris\\\\vmo-frontend-2011-tw-xmas\\\\packages\\\\web\\\\components\\\\LeaderboardContainer\\\\LeaderboardContainer.tsx\";\n// 2002-tw-alliance\nimport React, { useState, memo, useEffect, useMemo, useRef, useContext } from 'react';\nimport { createPortal } from 'react-dom';\nimport styled from 'styled-components';\nimport { now } from '@17media/dad';\nimport { TabsRefContext } from '@vmo/ui/hooks/TabsRefContext';\nimport Loading from '@vmo/ui/Loading';\nimport useQueryString from '@vmo/ui/hooks/useQueryString';\nimport useTypeApi from '@vmo/ui/hooks/api/useTypeApi';\nimport { SectionTypes, LocakTotalTime, LocakTotalTime2 } from '@vmo/web/constants/config';\nimport { useMinSectionTracking, createSectionViewAction } from '17media-browser-spy';\nimport { trackingSource } from '@vmo/share/17appTrack';\nimport { api } from '@vmo/web/constants/api';\nimport * as Conditions from '@vmo/web/constants/conditions';\nimport { Leaderboard } from '../leaderboard';\nimport images from '../../themes/images';\nimport { MissionPanelContext } from '../../context/missionPanelContext';\nexport const LeaderboardContainerWrapper = styled.div.withConfig({\n  displayName: \"LeaderboardContainer__LeaderboardContainerWrapper\",\n  componentId: \"sc-1qmnh3n-0\"\n})([\"margin-top:\", \";@media screen and (min-width:800px){margin-top:\", \";}\"], props => props.styleInfo.marginTop ? `${props.styleInfo.marginTop}vw` : 0, props => props.styleInfo.marginTop ? `calc((800 / 828) * ${props.styleInfo.marginTop * 414 / 100 * 2}px)` : 0);\nconst VideoContainer = styled.div.withConfig({\n  displayName: \"LeaderboardContainer__VideoContainer\",\n  componentId: \"sc-1qmnh3n-1\"\n})([\"position:fixed;width:100%;height:100%;margin:0 auto;font-weight:bold;display:flex;justify-content:center;align-content:center;background:rgba(0,0,0,0.95);top:0;left:0;video{width:100%;height:100%;max-width:800px;min-height:100vh;}img{position:absolute;top:10px;right:10px;width:40px;height:40px;cursor:pointer;border:1px solid #816530;border-radius:50%;}\"]);\n\nconst Iframe = ({\n  src\n}) => {\n  const descriptionRef = useRef(null);\n  useMinSectionTracking(descriptionRef, () => {\n    trackingSource.track(createSectionViewAction(SectionTypes.description));\n  });\n  useEffect(() => {\n    const frame = document.querySelector('#frame');\n    frame.style.overflow = 'hidden';\n    window.addEventListener('message', e => {\n      if (e.data.source && e.data.source.indexOf('main-vision') === -1 && e.data.size) {\n        frame.style.height = `${e.data.size.height}px`;\n      }\n    });\n    return () => window.removeEventListener('message', () => {});\n  }, []);\n  return /*#__PURE__*/React.createElement(\"iframe\", {\n    ref: descriptionRef,\n    id: \"frame\",\n    src: src,\n    frameBorder: \"0\",\n    width: \"100%\",\n    scrolling: \"no\",\n    title: \"event description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 5\n    }\n  });\n};\n\nconst RenderVideo = ({\n  src,\n  poster,\n  setShowVideo\n}) => {\n  const appBody = document.querySelector('body');\n  /* eslint-disable */\n\n  const content = /*#__PURE__*/React.createElement(VideoContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    src: src,\n    controls: true,\n    autoPlay: true,\n    poster: poster,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"img\", {\n    src: images.closeButton,\n    alt: \"\",\n    onClick: () => setShowVideo({\n      isShow: false,\n      poster: '',\n      video: ''\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }\n  }));\n  /* eslint-enable */\n\n  useEffect(() => {\n    const body = document.querySelector('body');\n    body.style.overflow = 'hidden';\n    return () => {\n      body.style.overflow = 'auto';\n    };\n  }, []);\n  return createPortal(content, appBody);\n};\n\nconst checkLockTime = () => {\n  const nowTime = now() * 1000;\n  const locakTime = Date.parse(LocakTotalTime);\n\n  if (nowTime >= locakTime) {\n    return true;\n  }\n\n  return false;\n};\n\nconst checkLockTime2 = () => {\n  const nowTime = now() * 1000;\n  const locakTime = Date.parse(LocakTotalTime2);\n\n  if (nowTime >= locakTime) {\n    return true;\n  }\n\n  return false;\n};\n\nconst LeaderboardContainer = ({\n  apis,\n  sortFunc = data => data,\n  realTime = 0,\n  hashCheck = true,\n  iframe,\n  condition,\n  initialData\n}) => {\n  const tabsRef = useContext(TabsRefContext);\n  const [showPanelID, setShowPanelID] = useState('');\n  const [missionDetails, setMissionDetails] = useState([]);\n  let finalApis = apis;\n  let finalConditaion = condition;\n\n  if (apis && apis[0] && apis[0] === api.total.attend.before) {\n    if (checkLockTime2()) {\n      finalApis = [api.total.attend.after, api.total.bonus];\n      finalConditaion = Conditions.rank512;\n    } else if (checkLockTime()) {\n      finalApis = [api.total.attend.after, api.total.bonus];\n      finalConditaion = Conditions.rank511;\n    } else {\n      finalApis = [api.total.attend.before, api.total.bonus];\n      finalConditaion = Conditions.rank0;\n    }\n  }\n\n  const {\n    loading,\n    leaderboardData\n  } = useTypeApi(finalApis, 'GET', realTime, hashCheck, initialData);\n  useQueryString(loading);\n  /* eslint-disable */\n\n  const props = useMemo(() => ({\n    leaderboardData: sortFunc(leaderboardData),\n    condition: finalConditaion,\n    isLocked: false\n  }), [leaderboardData, condition]); // const showBackToTopFlag = useRef(false);\n  // const [backToTopShow, setBackToTopShow] = useState(false);\n  // const handleClickBackToTop = useCallback(() => {\n  //   if (tabsRef) {\n  //     window.scrollTo({\n  //       top: tabsRef.current.offsetTop,\n  //       behavior: 'smooth',\n  //     });\n  //   }\n  // }, [backToTopShow]);\n  // const scrollBackToTop = useCallback(() => {\n  //   if (\n  //     document.body.scrollTop > 700 ||\n  //     document.documentElement.scrollTop > 700) {\n  //       if (!showBackToTopFlag.current) {\n  //         showBackToTopFlag.current = true;\n  //         setBackToTopShow(true);\n  //       }\n  //   } else if (\n  //     document.body.scrollTop <= 700 ||\n  //      document.documentElement.scrollTop <= 700\n  //     ) {\n  //       if (showBackToTopFlag.current) {\n  //         showBackToTopFlag.current = false;\n  //         setBackToTopShow(false);\n  //       }\n  //   }\n  // }, [showBackToTopFlag.current]);\n  // useEffect(() => {\n  //   window.addEventListener('scroll', scrollBackToTop);\n  //   return () => {\n  //     window.removeEventListener('scroll', scrollBackToTop);\n  //   };\n  // });\n\n  /* eslint-enable */\n\n  if (loading) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"loading-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Loading, {\n      color: \"#fe41cb\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  if (iframe) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Iframe, {\n      src: iframe,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 11\n      }\n    })));\n  }\n\n  return /*#__PURE__*/React.createElement(MissionPanelContext.Provider, {\n    value: {\n      showPanelID,\n      setShowPanelID,\n      missionDetails,\n      setMissionDetails\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Leaderboard, _extends({}, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }\n  })));\n};\n\nexport default memo(LeaderboardContainer);","map":{"version":3,"sources":["D:/17專案/客製化ui專案/2011-tw-xmas chris/vmo-frontend-2011-tw-xmas/packages/web/components/LeaderboardContainer/LeaderboardContainer.tsx"],"names":["React","useState","memo","useEffect","useMemo","useRef","useContext","createPortal","styled","now","TabsRefContext","Loading","useQueryString","useTypeApi","SectionTypes","LocakTotalTime","LocakTotalTime2","useMinSectionTracking","createSectionViewAction","trackingSource","api","Conditions","Leaderboard","images","MissionPanelContext","LeaderboardContainerWrapper","div","props","styleInfo","marginTop","VideoContainer","Iframe","src","descriptionRef","track","description","frame","document","querySelector","style","overflow","window","addEventListener","e","data","source","indexOf","size","height","removeEventListener","RenderVideo","poster","setShowVideo","appBody","content","closeButton","isShow","video","body","checkLockTime","nowTime","locakTime","Date","parse","checkLockTime2","LeaderboardContainer","apis","sortFunc","realTime","hashCheck","iframe","condition","initialData","tabsRef","showPanelID","setShowPanelID","missionDetails","setMissionDetails","finalApis","finalConditaion","total","attend","before","after","bonus","rank512","rank511","rank0","loading","leaderboardData","isLocked"],"mappings":"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","sourcesContent":["// 2002-tw-alliance\nimport React, {\n  useState,\n  memo,\n  useEffect,\n  useMemo,\n  useRef,\n  useCallback,\n  useContext,\n} from 'react';\nimport { createPortal } from 'react-dom';\nimport styled from 'styled-components';\nimport { now } from '@17media/dad';\n\nimport { TabsRefContext } from '@vmo/ui/hooks/TabsRefContext';\nimport Loading from '@vmo/ui/Loading';\nimport useQueryString from '@vmo/ui/hooks/useQueryString';\nimport useTypeApi from '@vmo/ui/hooks/api/useTypeApi';\nimport { WrapperedProps } from '@vmo/ui/hoc/WithLeaderboard/WithLeaderboard';\nimport {\n  SectionTypes,\n  LocakTotalTime,\n  LocakTotalTime2,\n} from '@vmo/web/constants/config';\nimport {\n  useMinSectionTracking,\n  createSectionViewAction,\n} from '17media-browser-spy';\nimport { trackingSource } from '@vmo/share/17appTrack';\nimport { BackToTop } from '@vmo/web/components/Tabs/styled';\nimport { api } from '@vmo/web/constants/api';\nimport * as Conditions from '@vmo/web/constants/conditions';\nimport { Leaderboard } from '../leaderboard';\nimport images from '../../themes/images';\nimport { MissionPanelContext } from '../../context/missionPanelContext';\n\nexport const LeaderboardContainerWrapper = styled.div<{\n  styleInfo?: { marginTop?: number };\n}>`\n  margin-top: ${props =>\n    props.styleInfo.marginTop ? `${props.styleInfo.marginTop}vw` : 0};\n  @media screen and (min-width: 800px) {\n    margin-top: ${props =>\n      props.styleInfo.marginTop\n        ? `calc((800 / 828) * ${((props.styleInfo.marginTop * 414) / 100) *\n            2}px)`\n        : 0};\n  }\n`;\n\nconst VideoContainer = styled.div`\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  margin: 0 auto;\n  font-weight: bold;\n  display: flex;\n  justify-content: center;\n  align-content: center;\n  background: rgba(0, 0, 0, 0.95);\n  top: 0;\n  left: 0;\n  video {\n    width: 100%;\n    height: 100%;\n    max-width: 800px;\n    min-height: 100vh;\n  }\n  img {\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    width: 40px;\n    height: 40px;\n    cursor: pointer;\n    border: 1px solid #816530;\n    border-radius: 50%;\n  }\n`;\n\nconst Iframe: React.FC<{ src: string }> = ({ src }) => {\n  const descriptionRef = useRef(null);\n  useMinSectionTracking(descriptionRef, () => {\n    trackingSource.track(createSectionViewAction(SectionTypes.description));\n  });\n  useEffect(() => {\n    const frame = document.querySelector('#frame') as HTMLElement;\n    frame.style.overflow = 'hidden';\n    window.addEventListener('message', e => {\n      if (\n        e.data.source &&\n        e.data.source.indexOf('main-vision') === -1 &&\n        e.data.size\n      ) {\n        frame.style.height = `${e.data.size.height}px`;\n      }\n    });\n    return () => window.removeEventListener('message', () => {});\n  }, []);\n\n  return (\n    <iframe\n      ref={descriptionRef}\n      id=\"frame\"\n      src={src}\n      frameBorder=\"0\"\n      width=\"100%\"\n      scrolling=\"no\"\n      title=\"event description\"\n    />\n  );\n};\n\nconst RenderVideo = ({ src, poster, setShowVideo }) => {\n  const appBody = document.querySelector('body');\n  /* eslint-disable */\n  const content = (\n    <VideoContainer>\n      <video src={src} controls autoPlay poster={poster} />\n      <img\n        src={images.closeButton}\n        alt=\"\"\n        onClick={() => setShowVideo({ isShow: false, poster: '', video: '' })}\n      />\n    </VideoContainer>\n  );\n  /* eslint-enable */\n  useEffect(() => {\n    const body = document.querySelector('body');\n    body.style.overflow = 'hidden';\n    return () => {\n      body.style.overflow = 'auto';\n    };\n  }, []);\n  return createPortal(content, appBody);\n};\n\nconst checkLockTime = () => {\n  const nowTime = now() * 1000;\n  const locakTime = Date.parse(LocakTotalTime);\n  if (nowTime >= locakTime) {\n    return true;\n  }\n  return false;\n};\n\nconst checkLockTime2 = () => {\n  const nowTime = now() * 1000;\n  const locakTime = Date.parse(LocakTotalTime2);\n  if (nowTime >= locakTime) {\n    return true;\n  }\n  return false;\n};\n\nconst LeaderboardContainer: React.FC<WrapperedProps> = ({\n  apis,\n  sortFunc = data => data,\n  realTime = 0,\n  hashCheck = true,\n  iframe,\n  condition,\n  initialData,\n}) => {\n  const tabsRef = useContext(TabsRefContext);\n  const [showPanelID, setShowPanelID] = useState<string>('');\n  const [missionDetails, setMissionDetails] = useState([]);\n  let finalApis = apis;\n  let finalConditaion = condition;\n  if (apis && apis[0] && apis[0] === api.total.attend.before) {\n    if (checkLockTime2()) {\n      finalApis = [api.total.attend.after, api.total.bonus];\n      finalConditaion = Conditions.rank512;\n    } else if (checkLockTime()) {\n      finalApis = [api.total.attend.after, api.total.bonus];\n      finalConditaion = Conditions.rank511;\n    } else {\n      finalApis = [api.total.attend.before, api.total.bonus];\n      finalConditaion = Conditions.rank0;\n    }\n  }\n  const { loading, leaderboardData } = useTypeApi(\n    finalApis,\n    'GET',\n    realTime,\n    hashCheck,\n    initialData,\n  );\n  useQueryString(loading);\n  /* eslint-disable */\n  const props = useMemo(\n    () => ({\n      leaderboardData: sortFunc(leaderboardData),\n      condition: finalConditaion,\n      isLocked: false,\n    }),\n    [leaderboardData, condition],\n    \n  );\n  // const showBackToTopFlag = useRef(false);\n  // const [backToTopShow, setBackToTopShow] = useState(false);\n  // const handleClickBackToTop = useCallback(() => {\n  //   if (tabsRef) {\n  //     window.scrollTo({\n  //       top: tabsRef.current.offsetTop,\n  //       behavior: 'smooth',\n  //     });\n  //   }\n  // }, [backToTopShow]);\n  // const scrollBackToTop = useCallback(() => {\n  //   if (\n  //     document.body.scrollTop > 700 ||\n  //     document.documentElement.scrollTop > 700) {\n  //       if (!showBackToTopFlag.current) {\n  //         showBackToTopFlag.current = true;\n  //         setBackToTopShow(true);\n  //       }\n  //   } else if (\n  //     document.body.scrollTop <= 700 ||\n  //      document.documentElement.scrollTop <= 700\n  //     ) {\n  //       if (showBackToTopFlag.current) {\n  //         showBackToTopFlag.current = false;\n  //         setBackToTopShow(false);\n  //       }\n  //   }\n  // }, [showBackToTopFlag.current]);\n  // useEffect(() => {\n  //   window.addEventListener('scroll', scrollBackToTop);\n  //   return () => {\n  //     window.removeEventListener('scroll', scrollBackToTop);\n  //   };\n  // });\n  /* eslint-enable */\n  if (loading) {\n    return (\n      <div id=\"loading-container\">\n        <Loading color=\"#fe41cb\" />\n      </div>\n    );\n  }\n  if (iframe) {\n    return (\n      <>\n        <div>\n          <Iframe src={iframe} />\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <MissionPanelContext.Provider\n      value={{ showPanelID, setShowPanelID, missionDetails, setMissionDetails }}\n    >\n      <Leaderboard {...props} />\n    </MissionPanelContext.Provider>\n  );\n};\n\nexport default memo(LeaderboardContainer);\n"]},"metadata":{},"sourceType":"module"}