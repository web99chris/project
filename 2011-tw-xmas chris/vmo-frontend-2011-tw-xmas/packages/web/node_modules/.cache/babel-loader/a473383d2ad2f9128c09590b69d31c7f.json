{"ast":null,"code":"var _jsxFileName = \"D:\\\\17\\u5C08\\u6848\\\\\\u5BA2\\u88FD\\u5316ui\\u5C08\\u6848\\\\2011-tw-xmas\\\\vmo-frontend-2008-tw-momo\\\\packages\\\\ui\\\\VirtualizedList.tsx\";\nimport React, { useEffect, useRef, useCallback } from 'react';\nimport { VariableSizeList } from 'react-window';\nimport styled from 'styled-components';\nimport { useRankSectionTracking, createLeaderboardSectionViewAction } from '17media-browser-spy';\nimport { qs, cumulativeOffset } from '@vmo/share/utils';\nimport { trackingSource } from '@vmo/share/17appTrack';\nconst VariableSizeListContainer = styled(VariableSizeList).withConfig({\n  displayName: \"VirtualizedList__VariableSizeListContainer\",\n  componentId: \"sc-1lra6yy-0\"\n})([\"height:\", \"px !important;overflow:hidden !important;.virtualized-item:first-of-type{overflow:hidden;border-top-left-radius:2.6vw;border-top-right-radius:2.6vw;@media screen and (min-width:800px){border-top-left-radius:20px;border-top-right-radius:20px;}}.virtualized-item:last-of-type{overflow:hidden;border-bottom-left-radius:2.6vw;border-bottom-right-radius:2.6vw;@media screen and (min-width:800px){border-bottom-left-radius:20px;border-bottom-right-radius:20px;}}\"], props => props.calculatedHeight);\n\nconst TrackChildrenWrapper = ({\n  index,\n  style,\n  children,\n  rank\n}) => {\n  const ref = useRef(null);\n  useRankSectionTracking(ref, () => {\n    trackingSource.track(createLeaderboardSectionViewAction(rank));\n  });\n  return React.createElement(\"div\", {\n    ref: ref,\n    style: style,\n    className: \"virtualized-item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53\n    },\n    __self: this\n  }, children({\n    index\n  }));\n};\n\nexport const VirtualizedList = ({\n  dataset,\n  children,\n  itemHeight = 81,\n  updateOnID = '',\n  panelSize = 0\n}) => {\n  const listRef = useRef(null);\n  const queryString = qs();\n  const getInitScrollOffset = useCallback(() => {\n    if (listRef.current) {\n      // eslint-disable-next-line no-underscore-dangle\n      const boardRect = listRef.current._outerRef.getBoundingClientRect();\n\n      return boardRect.top < 0 ? -boardRect.top : 0;\n    }\n\n    return -1;\n  }, [listRef]);\n  const handleScroll = useCallback(() => {\n    const initialScrollOffset = getInitScrollOffset();\n\n    if (initialScrollOffset >= 0) {\n      listRef.current.scrollTo(initialScrollOffset);\n    }\n  }, [getInitScrollOffset]);\n  useEffect(() => {\n    window.addEventListener('scroll', handleScroll, true);\n    return () => window.removeEventListener('scroll', handleScroll, true);\n  }, [handleScroll]);\n  useEffect(() => {\n    if (queryString.streamerUserID) {\n      const fIndex = dataset.findIndex(item => item.userInfo.userID === queryString.streamerUserID);\n\n      if (fIndex > -1) {\n        window.scrollTo({\n          top: // eslint-disable-next-line no-underscore-dangle\n          cumulativeOffset(listRef.current._outerRef).top + fIndex * itemHeight\n        });\n      }\n    }\n  }, [dataset, itemHeight, queryString.streamerUserID]);\n  useEffect(() => {\n    listRef.current.resetAfterIndex(0, true);\n    setTimeout(() => {\n      handleScroll();\n    });\n  }, [handleScroll, updateOnID, dataset]);\n\n  const Row = ({\n    index,\n    style\n  }) => React.createElement(TrackChildrenWrapper, {\n    index: index,\n    style: style,\n    children: children,\n    rank: dataset[index].rank,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  });\n\n  const getItemSize = index => {\n    if (updateOnID && updateOnID === dataset[index].userID) {\n      return itemHeight + panelSize;\n    }\n\n    return itemHeight;\n  };\n\n  const getCalculatedHeight = () => {\n    if (updateOnID !== '') {\n      return dataset.length * itemHeight + panelSize + 10;\n    }\n\n    return dataset.length * itemHeight + 10;\n  };\n\n  return React.createElement(VariableSizeListContainer, {\n    ref: listRef,\n    height: window.innerHeight,\n    itemCount: dataset.length,\n    itemSize: getItemSize,\n    width: '100%',\n    calculatedHeight: getCalculatedHeight(),\n    initialScrollOffset: getInitScrollOffset(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }, Row);\n};","map":{"version":3,"sources":["D:/17專案/客製化ui專案/2011-tw-xmas/vmo-frontend-2008-tw-momo/packages/ui/VirtualizedList.tsx"],"names":["React","useEffect","useRef","useCallback","VariableSizeList","styled","useRankSectionTracking","createLeaderboardSectionViewAction","qs","cumulativeOffset","trackingSource","VariableSizeListContainer","props","calculatedHeight","TrackChildrenWrapper","index","style","children","rank","ref","track","VirtualizedList","dataset","itemHeight","updateOnID","panelSize","listRef","queryString","getInitScrollOffset","current","boardRect","_outerRef","getBoundingClientRect","top","handleScroll","initialScrollOffset","scrollTo","window","addEventListener","removeEventListener","streamerUserID","fIndex","findIndex","item","userInfo","userID","resetAfterIndex","setTimeout","Row","getItemSize","getCalculatedHeight","length","innerHeight"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,MAA3B,EAAmCC,WAAnC,QAAiE,OAAjE;AACA,SAASC,gBAAT,QAAiC,cAAjC;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,SACEC,sBADF,EAEEC,kCAFF,QAGO,qBAHP;AAKA,SAASC,EAAT,EAAaC,gBAAb,QAAqC,kBAArC;AAEA,SAASC,cAAT,QAA+B,uBAA/B;AAEA,MAAMC,yBAAyB,GAAGN,MAAM,CAACD,gBAAD,CAAT;AAAA;AAAA;AAAA,4dAGnBQ,KAAK,IAAIA,KAAK,CAACC,gBAHI,CAA/B;;AAiCA,MAAMC,oBAAoB,GAAG,CAAC;AAAEC,EAAAA,KAAF;AAASC,EAAAA,KAAT;AAAgBC,EAAAA,QAAhB;AAA0BC,EAAAA;AAA1B,CAAD,KAAsC;AACjE,QAAMC,GAAG,GAAGjB,MAAM,CAAC,IAAD,CAAlB;AACAI,EAAAA,sBAAsB,CAACa,GAAD,EAAM,MAAM;AAChCT,IAAAA,cAAc,CAACU,KAAf,CAAqBb,kCAAkC,CAACW,IAAD,CAAvD;AACD,GAFqB,CAAtB;AAIA,SACE;AAAK,IAAA,GAAG,EAAEC,GAAV;AAAe,IAAA,KAAK,EAAEH,KAAtB;AAA6B,IAAA,SAAS,EAAC,kBAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGC,QAAQ,CAAC;AAAEF,IAAAA;AAAF,GAAD,CADX,CADF;AAKD,CAXD;;AAaA,OAAO,MAAMM,eAA+C,GAAG,CAAC;AAC9DC,EAAAA,OAD8D;AAE9DL,EAAAA,QAF8D;AAG9DM,EAAAA,UAAU,GAAG,EAHiD;AAI9DC,EAAAA,UAAU,GAAG,EAJiD;AAK9DC,EAAAA,SAAS,GAAG;AALkD,CAAD,KAMzD;AACJ,QAAMC,OAAO,GAAGxB,MAAM,CAAM,IAAN,CAAtB;AACA,QAAMyB,WAAW,GAAGnB,EAAE,EAAtB;AAKA,QAAMoB,mBAAmB,GAAGzB,WAAW,CAAC,MAAM;AAC5C,QAAIuB,OAAO,CAACG,OAAZ,EAAqB;AACnB;AACA,YAAMC,SAAS,GAAGJ,OAAO,CAACG,OAAR,CAAgBE,SAAhB,CAA0BC,qBAA1B,EAAlB;;AACA,aAAOF,SAAS,CAACG,GAAV,GAAgB,CAAhB,GAAoB,CAACH,SAAS,CAACG,GAA/B,GAAqC,CAA5C;AACD;;AACD,WAAO,CAAC,CAAR;AACD,GAPsC,EAOpC,CAACP,OAAD,CAPoC,CAAvC;AASA,QAAMQ,YAAY,GAAG/B,WAAW,CAAC,MAAM;AACrC,UAAMgC,mBAAmB,GAAGP,mBAAmB,EAA/C;;AACA,QAAIO,mBAAmB,IAAI,CAA3B,EAA8B;AAC5BT,MAAAA,OAAO,CAACG,OAAR,CAAgBO,QAAhB,CAAyBD,mBAAzB;AACD;AACF,GAL+B,EAK7B,CAACP,mBAAD,CAL6B,CAAhC;AAOA3B,EAAAA,SAAS,CAAC,MAAM;AACdoC,IAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkCJ,YAAlC,EAAgD,IAAhD;AACA,WAAO,MAAMG,MAAM,CAACE,mBAAP,CAA2B,QAA3B,EAAqCL,YAArC,EAAmD,IAAnD,CAAb;AACD,GAHQ,EAGN,CAACA,YAAD,CAHM,CAAT;AAKAjC,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI0B,WAAW,CAACa,cAAhB,EAAgC;AAC9B,YAAMC,MAAM,GAAGnB,OAAO,CAACoB,SAAR,CACbC,IAAI,IAAIA,IAAI,CAACC,QAAL,CAAcC,MAAd,KAAyBlB,WAAW,CAACa,cADhC,CAAf;;AAGA,UAAIC,MAAM,GAAG,CAAC,CAAd,EAAiB;AACfJ,QAAAA,MAAM,CAACD,QAAP,CAAgB;AACdH,UAAAA,GAAG,EACD;AACAxB,UAAAA,gBAAgB,CAACiB,OAAO,CAACG,OAAR,CAAgBE,SAAjB,CAAhB,CAA4CE,GAA5C,GACAQ,MAAM,GAAGlB;AAJG,SAAhB;AAMD;AACF;AACF,GAdQ,EAcN,CAACD,OAAD,EAAUC,UAAV,EAAsBI,WAAW,CAACa,cAAlC,CAdM,CAAT;AAgBAvC,EAAAA,SAAS,CAAC,MAAM;AACdyB,IAAAA,OAAO,CAACG,OAAR,CAAgBiB,eAAhB,CAAgC,CAAhC,EAAmC,IAAnC;AACAC,IAAAA,UAAU,CAAC,MAAM;AACfb,MAAAA,YAAY;AACb,KAFS,CAAV;AAGD,GALQ,EAKN,CAACA,YAAD,EAAeV,UAAf,EAA2BF,OAA3B,CALM,CAAT;;AAOA,QAAM0B,GAAG,GAAG,CAAC;AAAEjC,IAAAA,KAAF;AAASC,IAAAA;AAAT,GAAD,KACV,oBAAC,oBAAD;AACE,IAAA,KAAK,EAAED,KADT;AAEE,IAAA,KAAK,EAAEC,KAFT;AAGE,IAAA,QAAQ,EAAEC,QAHZ;AAIE,IAAA,IAAI,EAAEK,OAAO,CAACP,KAAD,CAAP,CAAeG,IAJvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF;;AASA,QAAM+B,WAAW,GAAIlC,KAAD,IAA2B;AAC7C,QAAIS,UAAU,IAAIA,UAAU,KAAKF,OAAO,CAACP,KAAD,CAAP,CAAe8B,MAAhD,EAAwD;AACtD,aAAOtB,UAAU,GAAGE,SAApB;AACD;;AACD,WAAOF,UAAP;AACD,GALD;;AAOA,QAAM2B,mBAAmB,GAAG,MAAM;AAChC,QAAI1B,UAAU,KAAK,EAAnB,EAAuB;AACrB,aAAOF,OAAO,CAAC6B,MAAR,GAAiB5B,UAAjB,GAA8BE,SAA9B,GAA0C,EAAjD;AACD;;AACD,WAAOH,OAAO,CAAC6B,MAAR,GAAiB5B,UAAjB,GAA8B,EAArC;AACD,GALD;;AAOA,SACE,oBAAC,yBAAD;AACE,IAAA,GAAG,EAAEG,OADP;AAEE,IAAA,MAAM,EAAEW,MAAM,CAACe,WAFjB;AAGE,IAAA,SAAS,EAAE9B,OAAO,CAAC6B,MAHrB;AAIE,IAAA,QAAQ,EAAEF,WAJZ;AAKE,IAAA,KAAK,EAAE,MALT;AAME,IAAA,gBAAgB,EAAEC,mBAAmB,EANvC;AAOE,IAAA,mBAAmB,EAAEtB,mBAAmB,EAP1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASGoB,GATH,CADF;AAaD,CA7FM","sourcesContent":["import React, { useEffect, useRef, useCallback, ReactNode } from 'react';\nimport { VariableSizeList } from 'react-window';\nimport styled from 'styled-components';\nimport {\n  useRankSectionTracking,\n  createLeaderboardSectionViewAction,\n} from '17media-browser-spy';\n\nimport { qs, cumulativeOffset } from '@vmo/share/utils';\nimport { LeaderboardItem as LeaderboardItemInterface } from '@vmo/share/interfaces/LeaderboardItem';\nimport { trackingSource } from '@vmo/share/17appTrack';\n\nconst VariableSizeListContainer = styled(VariableSizeList)<{\n  calculatedHeight: number;\n}>`\n  height: ${props => props.calculatedHeight}px !important;\n  overflow: hidden !important;\n  .virtualized-item:first-of-type {\n    overflow: hidden;\n    border-top-left-radius: 2.6vw;\n    border-top-right-radius: 2.6vw;\n    @media screen and (min-width: 800px) {\n      border-top-left-radius: 20px;\n      border-top-right-radius: 20px;\n    }\n  }\n  .virtualized-item:last-of-type {\n    overflow: hidden;\n    border-bottom-left-radius: 2.6vw;\n    border-bottom-right-radius: 2.6vw;\n    @media screen and (min-width: 800px) {\n      border-bottom-left-radius: 20px;\n      border-bottom-right-radius: 20px;\n    }\n  }\n`;\n\ninterface VirtualizedListProps {\n  dataset: LeaderboardItemInterface[];\n  updateOnID: string;\n  children({ index }): ReactNode;\n  itemHeight: number;\n  panelSize?: number;\n}\n\nconst TrackChildrenWrapper = ({ index, style, children, rank }) => {\n  const ref = useRef(null);\n  useRankSectionTracking(ref, () => {\n    trackingSource.track(createLeaderboardSectionViewAction(rank));\n  });\n\n  return (\n    <div ref={ref} style={style} className=\"virtualized-item\">\n      {children({ index })}\n    </div>\n  );\n};\n\nexport const VirtualizedList: React.FC<VirtualizedListProps> = ({\n  dataset,\n  children,\n  itemHeight = 81,\n  updateOnID = '',\n  panelSize = 0,\n}) => {\n  const listRef = useRef<any>(null);\n  const queryString = qs<{\n    copy: string;\n    streamerUserID: string;\n    count: string;\n  }>();\n  const getInitScrollOffset = useCallback(() => {\n    if (listRef.current) {\n      // eslint-disable-next-line no-underscore-dangle\n      const boardRect = listRef.current._outerRef.getBoundingClientRect();\n      return boardRect.top < 0 ? -boardRect.top : 0;\n    }\n    return -1;\n  }, [listRef]);\n\n  const handleScroll = useCallback(() => {\n    const initialScrollOffset = getInitScrollOffset();\n    if (initialScrollOffset >= 0) {\n      listRef.current.scrollTo(initialScrollOffset);\n    }\n  }, [getInitScrollOffset]);\n\n  useEffect(() => {\n    window.addEventListener('scroll', handleScroll, true);\n    return () => window.removeEventListener('scroll', handleScroll, true);\n  }, [handleScroll]);\n\n  useEffect(() => {\n    if (queryString.streamerUserID) {\n      const fIndex = dataset.findIndex(\n        item => item.userInfo.userID === queryString.streamerUserID,\n      );\n      if (fIndex > -1) {\n        window.scrollTo({\n          top:\n            // eslint-disable-next-line no-underscore-dangle\n            cumulativeOffset(listRef.current._outerRef).top +\n            fIndex * itemHeight,\n        });\n      }\n    }\n  }, [dataset, itemHeight, queryString.streamerUserID]);\n\n  useEffect(() => {\n    listRef.current.resetAfterIndex(0, true);\n    setTimeout(() => {\n      handleScroll();\n    });\n  }, [handleScroll, updateOnID, dataset]);\n\n  const Row = ({ index, style }) => (\n    <TrackChildrenWrapper\n      index={index}\n      style={style}\n      children={children}\n      rank={dataset[index].rank}\n    />\n  );\n\n  const getItemSize = (index: number): number => {\n    if (updateOnID && updateOnID === dataset[index].userID) {\n      return itemHeight + panelSize;\n    }\n    return itemHeight;\n  };\n\n  const getCalculatedHeight = () => {\n    if (updateOnID !== '') {\n      return dataset.length * itemHeight + panelSize + 10;\n    }\n    return dataset.length * itemHeight + 10;\n  };\n\n  return (\n    <VariableSizeListContainer\n      ref={listRef}\n      height={window.innerHeight}\n      itemCount={dataset.length}\n      itemSize={getItemSize}\n      width={'100%'}\n      calculatedHeight={getCalculatedHeight()}\n      initialScrollOffset={getInitScrollOffset()}\n    >\n      {Row}\n    </VariableSizeListContainer>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}