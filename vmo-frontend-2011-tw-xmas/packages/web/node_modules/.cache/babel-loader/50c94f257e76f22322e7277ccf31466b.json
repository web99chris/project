{"ast":null,"code":"var _jsxFileName = \"D:\\\\17\\u5C08\\u6848\\\\\\u5BA2\\u88FD\\u5316ui\\u5C08\\u6848\\\\vmo-frontend-2011-tw-xmas\\\\packages\\\\web\\\\components\\\\leaderboard\\\\MissionPanel.tsx\";\nimport React, { useContext, useEffect, useRef, memo } from 'react';\nimport axios from 'axios';\nimport Loading from '@vmo/ui/Loading';\nimport { getEventoryDetails } from '@vmo/share/services/leaderboardEventory.service';\nimport { WrapPanel, WrapMission, WrapMetaScore, WrapBonusPanel, Borderline } from './style';\nimport { MissionPanelContext } from '../../context/missionPanelContext';\n\nconst RenderMission = ({\n  mission,\n  score,\n  isChecked\n}) => {\n  return /*#__PURE__*/React.createElement(WrapMission, {\n    isChecked: isChecked,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 12,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mission-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 7\n    }\n  }, mission.title), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mission-description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 14,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 9\n    }\n  }, mission.description, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mission-prize\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 9\n    }\n  }, mission.prize), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mission-threshold\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 17,\n      columnNumber: 9\n    }\n  }, \"\\u76EE\\u524D\\u7D2F\\u7A4D\\u6578\\u91CF(\", score, \"/\", mission.threshold, \")\"))), mission.threshold && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mission-check\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 22,\n      columnNumber: 29\n    }\n  }));\n};\n\nconst RenderBonus = ({\n  bonus,\n  score\n}) => {\n  return /*#__PURE__*/React.createElement(WrapBonusPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 30,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bonus_title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 7\n    }\n  }, \"\\u52A0\\u5206\\u8A73\\u60C5\"), /*#__PURE__*/React.createElement(\"section\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 11\n    }\n  }, \"\\u968E\\u6BB5\\u56DB\"), \" \", /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 28\n    }\n  }, \"+\", meta.s4 || 0)), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 11\n    }\n  }, \"Round 2\"), \" \", /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 32\n    }\n  }, \"+\", meta.r2 || 0))), /*#__PURE__*/React.createElement(Borderline, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default memo(({\n  condition,\n  userID,\n  meta = {}\n}) => {\n  const source = useRef();\n  const panelState = useContext(MissionPanelContext);\n  const {\n    missionDetails,\n    setMissionDetails\n  } = panelState;\n  const {\n    needRequest,\n    missions,\n    bonus\n  } = condition;\n  useEffect(() => {\n    if (needRequest && missionDetails.length === 0) {\n      const subKeys = userID;\n      source.current = axios.CancelToken.source();\n      const cancelToken = source.current.token;\n      getEventoryDetails(condition.containerID, subKeys, cancelToken).then(result => {\n        const detailList = [];\n\n        if (result && result.data) {\n          result.data.forEach(item => {\n            if (item.meta && item.meta.eventoryKey) detailList.push({\n              eventoryKey: item.meta.eventoryKey,\n              score: item.score\n            });\n          });\n        } else {\n          detailList.push({\n            eventoryKey: '',\n            score: 0\n          });\n        }\n\n        setMissionDetails(detailList);\n      });\n    }\n\n    return () => {\n      if (source.current) source.current.cancel();\n    };\n  }, [condition.containerID, missionDetails.length, needRequest, setMissionDetails, userID]);\n\n  const RenderMetaScore = ({\n    mission,\n    bonus\n  }) => {\n    return /*#__PURE__*/React.createElement(WrapMetaScore, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mission-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }\n    }, mission.title), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mission-description\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }\n    }, \"+ \", meta[mission.metaKey], \" \\u5206\"));\n  };\n\n  if (needRequest && missionDetails.length === 0) {\n    return /*#__PURE__*/React.createElement(WrapPanel, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Loading, {\n      color: \"#ffffff\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  return /*#__PURE__*/React.createElement(WrapPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 5\n    }\n  }, missions.map(item => {\n    if (needRequest) {\n      let isChecked = false;\n      let score = 0;\n\n      if (missionDetails.length > 0) {\n        const missionMatched = missionDetails.find(detail => detail.eventoryKey.includes(item.eventoryKey));\n\n        if (missionMatched) {\n          isChecked = missionMatched.score >= item.threshold;\n          score = missionMatched.score >= item.threshold ? item.threshold : missionMatched.score;\n        }\n      }\n\n      return /*#__PURE__*/React.createElement(RenderMission, {\n        key: item.title,\n        mission: item,\n        score: score,\n        isChecked: isChecked,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 13\n        }\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(RenderMetaScore, {\n      key: item.title,\n      mission: item,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 16\n      }\n    });\n  }));\n});","map":{"version":3,"sources":["D:/17專案/客製化ui專案/vmo-frontend-2011-tw-xmas/packages/web/components/leaderboard/MissionPanel.tsx"],"names":["React","useContext","useEffect","useRef","memo","axios","Loading","getEventoryDetails","WrapPanel","WrapMission","WrapMetaScore","WrapBonusPanel","Borderline","MissionPanelContext","RenderMission","mission","score","isChecked","title","description","prize","threshold","RenderBonus","bonus","meta","s4","r2","condition","userID","source","panelState","missionDetails","setMissionDetails","needRequest","missions","length","subKeys","current","CancelToken","cancelToken","token","containerID","then","result","detailList","data","forEach","item","eventoryKey","push","cancel","RenderMetaScore","metaKey","map","missionMatched","find","detail","includes"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, memo } from 'react';\nimport axios, { CancelTokenSource } from 'axios';\n\nimport Loading from '@vmo/ui/Loading';\nimport { getEventoryDetails } from '@vmo/share/services/leaderboardEventory.service';\n\nimport { WrapPanel, WrapMission, WrapMetaScore,WrapBonusPanel,Borderline } from './style';\nimport { MissionPanelContext } from '../../context/missionPanelContext';\n\nconst RenderMission = ({ mission, score, isChecked }) => {\n  return (\n    <WrapMission isChecked={isChecked}>\n      <div className=\"mission-title\">{mission.title}</div>\n      <div className=\"mission-description\">\n        <div>{mission.description}\n        <div className=\"mission-prize\">{mission.prize}</div>\n        <div className=\"mission-threshold\">\n          目前累積數量({score}/{mission.threshold})\n        </div>\n        </div>\n      </div>\n      {mission.threshold && <div className=\"mission-check\" />}\n    </WrapMission>\n  );\n};\n\nconst RenderBonus = ({ bonus, score }) => {\n  return (\n \n    <WrapBonusPanel>\n      <div className=\"bonus_title\">加分詳情</div>\n      <section>\n        <div>\n          <span>階段四</span> <span>+{meta.s4 || 0}</span>\n        </div>\n        <div>\n          <span>Round 2</span> <span>+{meta.r2 || 0}</span>\n        </div>\n      </section>\n      <Borderline />\n    </WrapBonusPanel>\n  );\n};\n\nexport default memo(({ condition, userID, meta = {} }) => {\n  const source = useRef<CancelTokenSource>();\n  const panelState = useContext(MissionPanelContext);\n  const { missionDetails, setMissionDetails } = panelState;\n\n  const { needRequest, missions , bonus } = condition;\n\n  useEffect(() => {\n    if (needRequest && missionDetails.length === 0) {\n      const subKeys = userID;\n      source.current = axios.CancelToken.source();\n      const cancelToken = source.current.token;\n      getEventoryDetails(condition.containerID, subKeys, cancelToken).then(\n        result => {\n          const detailList = [];\n          if (result && result.data) {\n            result.data.forEach(item => {\n              if (item.meta && item.meta.eventoryKey)\n                detailList.push({\n                  eventoryKey: item.meta.eventoryKey,\n                  score: item.score,\n                });\n            });\n          } else {\n            detailList.push({\n              eventoryKey: '',\n              score: 0,\n            });\n          }\n\n          setMissionDetails(detailList);\n        },\n      );\n    }\n    return () => {\n      if (source.current) source.current.cancel();\n    };\n  }, [\n    condition.containerID,\n    missionDetails.length,\n    needRequest,\n    setMissionDetails,\n    userID,\n  ]);\n\n  const RenderMetaScore = ({ mission , bonus }) => {\n    return (\n      <WrapMetaScore>\n        <div className=\"mission-title\">{mission.title}</div>\n        <div className=\"mission-description\">+ {meta[mission.metaKey]} 分</div>\n      </WrapMetaScore>\n    );\n  };\n\n  if (needRequest && missionDetails.length === 0) {\n    return (\n      <WrapPanel>\n        <Loading color=\"#ffffff\" />\n      </WrapPanel>\n    );\n  }\n\n  return (\n    <WrapPanel>\n      {missions.map(item => {\n        if (needRequest) {\n          let isChecked = false;\n          let score = 0;\n          if (missionDetails.length > 0) {\n            const missionMatched = missionDetails.find(detail =>\n              detail.eventoryKey.includes(item.eventoryKey),\n            );\n            if (missionMatched) {\n              isChecked = missionMatched.score >= item.threshold;\n              score =\n                missionMatched.score >= item.threshold\n                  ? item.threshold\n                  : missionMatched.score;\n            }\n          }\n          return (\n            <RenderMission\n              key={item.title}\n              mission={item}\n              score={score}\n              isChecked={isChecked}\n            />\n          );\n        }\n        return <RenderMetaScore key={item.title} mission={item} />;\n      })}\n      \n    </WrapPanel>\n  );\n});\n\n"]},"metadata":{},"sourceType":"module"}