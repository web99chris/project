{"ast":null,"code":"var _jsxFileName = \"D:\\\\17\\u5C08\\u6848\\\\\\u5BA2\\u88FD\\u5316ui\\u5C08\\u6848\\\\2011-tw-xmas\\\\vmo-frontend-2008-tw-momo\\\\packages\\\\ui\\\\Countdown.tsx\";\nimport React, { memo, useContext, useRef } from 'react';\nimport styled, { ThemeProvider } from 'styled-components';\nimport { now } from '@17media/dad';\nimport * as utils from '@vmo/share/utils';\nimport { useCountDown } from '@vmo/ui/hooks';\nimport { TranslationContext } from '@vmo/web/context/translationContext';\nimport { SectionTypes } from '@vmo/web/constants/config';\nimport { useMinSectionTracking, createSectionViewAction } from '17media-browser-spy';\nimport { trackingSource } from '@vmo/share/17appTrack';\nexport const WrapCountdown = styled.div.withConfig({\n  displayName: \"Countdown__WrapCountdown\",\n  componentId: \"h7ic9x-0\"\n})([\"\"]);\nexport const WrapCountdownContent = styled.div.withConfig({\n  displayName: \"Countdown__WrapCountdownContent\",\n  componentId: \"h7ic9x-1\"\n})([\"display:flex;flex:0 0 auto;flex-direction:column;justify-content:flex-start;align-items:center;> div{display:flex;flex:0 0 auto;justify-content:center;align-content:center;align-self:center;width:77.29vw;font-size:3.86vw;text-align:center;:nth-child(1){margin-top:6.76vw;margin-bottom:0.84vw;border-bottom:1px solid #cd3f6e;}:nth-child(2){margin-top:0.36vw;}@media screen and (min-width:800px){font-size:calc((800 / 828) * 32px);width:calc((800 / 828) * 640px);:nth-child(1){margin-top:calc((800 / 828) * 56px);margin-bottom:calc((800 / 828) * 7px);}:nth-child(2){margin-top:calc((800 / 828) * 3px);}}}\"]);\nexport const CountdownWrapper = ({\n  children\n}) => {\n  const timeRef = useRef(null);\n  useMinSectionTracking(timeRef, () => {\n    trackingSource.track(createSectionViewAction(SectionTypes.duration));\n  });\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69\n    },\n    __self: this\n  }, children);\n};\nexport const Countdown = ({\n  theme = {},\n  startDate,\n  endDate,\n  className,\n  isSameDay = false,\n  dateFormat,\n  formatStr = ''\n}) => {\n  const translation = useContext(TranslationContext);\n  const start = new Date(startDate);\n  const end = new Date(endDate);\n  const nowTime = now() * 1000;\n  const times = useCountDown(end.getTime());\n  const notYetStarted = nowTime - start.getTime() < 0;\n  const ended = nowTime - end.getTime() > 0;\n  let msg;\n  let msgDateRange = React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }, `${utils.getStringDateByLocalFormat(startDate, dateFormat)}－${utils.getStringDateByLocalFormat(endDate, dateFormat)}`);\n\n  if (notYetStarted) {\n    msg = React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96\n      },\n      __self: this\n    }, translation.get('COUNTDOWN_HAS_NOT_BEGUN'));\n  } else if (ended) {\n    msg = React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, translation.get('COUNTDOWN_HAS_ENDED'));\n  } else {\n    let format;\n\n    if (times.d === 1) {\n      format = formatStr.replace('{0}', `D${translation.get('COUNTDOWN_DAY')}`).replace('{1} {2}', `hh:mm:ss`);\n    } else {\n      format = formatStr.replace('{0}', `D${translation.get('COUNTDOWN_PLURAL_DAY')}`).replace('{1} {2}', `hh:mm:ss`);\n    }\n\n    msg = React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, utils.getStringDateCountdownByLocalFormat(times, format));\n  }\n\n  if (utils.isSameDate(startDate, endDate) && isSameDay) {\n    msgDateRange = React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, `${utils.getStringDateByLocalFormat(startDate, dateFormat)} - ${utils.convertDateToTime(endDate)}`);\n  }\n\n  return React.createElement(CountdownWrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, React.createElement(ThemeProvider, {\n    theme: theme,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, React.createElement(WrapCountdown, {\n    className: className,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, React.createElement(WrapCountdownContent, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, msgDateRange, msg))));\n};\nexport default memo(Countdown);","map":{"version":3,"sources":["D:/17專案/客製化ui專案/2011-tw-xmas/vmo-frontend-2008-tw-momo/packages/ui/Countdown.tsx"],"names":["React","memo","useContext","useRef","styled","ThemeProvider","now","utils","useCountDown","TranslationContext","SectionTypes","useMinSectionTracking","createSectionViewAction","trackingSource","WrapCountdown","div","WrapCountdownContent","CountdownWrapper","children","timeRef","track","duration","Countdown","theme","startDate","endDate","className","isSameDay","dateFormat","formatStr","translation","start","Date","end","nowTime","times","getTime","notYetStarted","ended","msg","msgDateRange","getStringDateByLocalFormat","get","format","d","replace","getStringDateCountdownByLocalFormat","isSameDate","convertDateToTime"],"mappings":"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","sourcesContent":["import React, { memo, useContext, useRef } from 'react';\nimport styled, { ThemeProvider } from 'styled-components';\nimport { now } from '@17media/dad';\n\nimport * as utils from '@vmo/share/utils';\nimport { useCountDown } from '@vmo/ui/hooks';\nimport { TranslationContext } from '@vmo/web/context/translationContext';\nimport { SectionTypes } from '@vmo/web/constants/config';\nimport { cal800, calVW } from '@vmo/web/components/Tabs/styled';\nimport {\n  useMinSectionTracking,\n  createSectionViewAction,\n} from '17media-browser-spy';\nimport { trackingSource } from '@vmo/share/17appTrack';\n\nexport const WrapCountdown = styled.div``;\nexport const WrapCountdownContent = styled.div`\n  display: flex;\n  flex: 0 0 auto;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  > div {\n    display: flex;\n    flex: 0 0 auto;\n    justify-content: center;\n    align-content: center;\n    align-self: center;\n    width: 77.29vw;\n    font-size: 3.86vw;\n    text-align: center;\n    :nth-child(1) {\n      margin-top: 6.76vw;\n      margin-bottom: 0.84vw;\n      border-bottom: 1px solid #cd3f6e;\n    }\n    :nth-child(2) {\n      margin-top: 0.36vw;\n    }\n    @media screen and (min-width: 800px) {\n      font-size: calc((800 / 828) * 32px);\n      width: calc((800 / 828) * 640px);\n      :nth-child(1) {\n        margin-top: calc((800 / 828) * 56px);\n        margin-bottom: calc((800 / 828) * 7px);\n      }\n      :nth-child(2) {\n        margin-top: calc((800 / 828) * 3px);\n      }\n    }\n  }\n`;\n\ninterface Props {\n  startDate: string;\n  endDate: string;\n  className?: string;\n  isSameDay?: boolean;\n  theme?: { colorFirst: string; colorLast: string };\n  dateFormat?: string;\n  formatStr?: string;\n}\n\nexport const CountdownWrapper = ({ children }) => {\n  const timeRef = useRef(null);\n  useMinSectionTracking(timeRef, () => {\n    trackingSource.track(createSectionViewAction(SectionTypes.duration));\n  });\n  return <div>{children}</div>;\n};\n\nexport const Countdown: React.FC<Props> = ({\n  theme = {},\n  startDate,\n  endDate,\n  className,\n  isSameDay = false,\n  dateFormat,\n  formatStr = '',\n}) => {\n  const translation = useContext(TranslationContext);\n  const start = new Date(startDate);\n  const end = new Date(endDate);\n  const nowTime = now() * 1000;\n  const times = useCountDown(end.getTime());\n  const notYetStarted = nowTime - start.getTime() < 0;\n  const ended = nowTime - end.getTime() > 0;\n  let msg: React.ReactElement;\n  let msgDateRange = (\n    <div>{`${utils.getStringDateByLocalFormat(\n      startDate,\n      dateFormat,\n    )}－${utils.getStringDateByLocalFormat(endDate, dateFormat)}`}</div>\n  );\n  if (notYetStarted) {\n    msg = <div>{translation.get('COUNTDOWN_HAS_NOT_BEGUN')}</div>;\n  } else if (ended) {\n    msg = <div>{translation.get('COUNTDOWN_HAS_ENDED')}</div>;\n  } else {\n    let format: string;\n    if (times.d === 1) {\n      format = formatStr\n        .replace('{0}', `D${translation.get('COUNTDOWN_DAY')}`)\n        .replace('{1} {2}', `hh:mm:ss`);\n    } else {\n      format = formatStr\n        .replace('{0}', `D${translation.get('COUNTDOWN_PLURAL_DAY')}`)\n        .replace('{1} {2}', `hh:mm:ss`);\n    }\n    msg = <div>{utils.getStringDateCountdownByLocalFormat(times, format)}</div>;\n  }\n  if (utils.isSameDate(startDate, endDate) && isSameDay) {\n    msgDateRange = (\n      <div>{`${utils.getStringDateByLocalFormat(\n        startDate,\n        dateFormat,\n      )} - ${utils.convertDateToTime(endDate)}`}</div>\n    );\n  }\n\n  return (\n    <CountdownWrapper>\n      <ThemeProvider theme={theme}>\n        <WrapCountdown className={className}>\n          <WrapCountdownContent>\n            {msgDateRange}\n            {msg}\n          </WrapCountdownContent>\n        </WrapCountdown>\n      </ThemeProvider>\n    </CountdownWrapper>\n  );\n};\n\nexport default memo(Countdown);\n"]},"metadata":{},"sourceType":"module"}