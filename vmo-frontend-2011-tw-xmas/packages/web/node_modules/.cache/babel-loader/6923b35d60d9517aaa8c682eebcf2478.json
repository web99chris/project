{"ast":null,"code":"var _jsxFileName = \"D:\\\\17\\u5C08\\u6848\\\\\\u5BA2\\u88FD\\u5316ui\\u5C08\\u6848\\\\2011-tw-xmas chris\\\\vmo-frontend-2011-tw-xmas\\\\packages\\\\web\\\\components\\\\leaderboard\\\\BonusPanel.tsx\";\n// import React from 'react';\n// import { WrapBonusPanel, Borderline } from './style';\n// export default ({ meta }) => {\n//   return (\n//     <WrapBonusPanel>\n//       <div className=\"bonus_title\">加分詳情</div>\n//       <section>\n//         <div>\n//           <span>階段四</span> <span>+{meta.s4 || 0}</span>\n//         </div>\n//         <div>\n//           <span>Round 2</span> <span>+{meta.r2 || 0}</span>\n//         </div>\n//       </section>\n//       <Borderline />\n//     </WrapBonusPanel>\n//   );\n// };\nimport React, { useContext, useEffect, useRef, memo } from 'react';\nimport axios from 'axios';\nimport { WrapBonusPanel, WrapPanel, Borderline } from './style';\nimport Loading from '@vmo/ui/Loading';\nimport { getEventoryDetails } from '@vmo/share/services/leaderboardEventory.service';\nimport { BonusPanelContext } from '../../context/bonusPanelContext';\n\nconst RenderMission = ({\n  bonus,\n  score\n}) => {\n  return /*#__PURE__*/React.createElement(WrapBonusPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bonus-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 7\n    }\n  }, bonus.title), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bonus-score\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 9\n    }\n  }, score, \"\\u5206\"));\n};\n\nexport default memo(({\n  condition,\n  userID,\n  meta = {}\n}) => {\n  const source = useRef();\n  const panelState = useContext(BonusPanelContext);\n  const {\n    BonusDetails,\n    setBonusDetails\n  } = panelState;\n  const {\n    needRequest,\n    bonus\n  } = condition;\n  useEffect(() => {\n    if (needRequest && BonusDetails.length === 0) {\n      const subKeys = userID;\n      source.current = axios.CancelToken.source();\n      const cancelToken = source.current.token;\n      getEventoryDetails(condition.containerID, subKeys, cancelToken).then(result => {\n        const detailList = [];\n\n        if (result && result.data) {\n          result.data.forEach(item => {\n            if (item.meta && item.meta.metaKey) detailList.push({\n              metaKey: item.meta.metaKey,\n              score: item.score\n            });\n          });\n        } else {\n          detailList.push({\n            metaKey: '',\n            score: 0\n          });\n        }\n\n        setBonusDetails(detailList);\n      });\n    }\n\n    return () => {\n      if (source.current) source.current.cancel();\n    };\n  }, [condition.containerID, BonusDetails.length, needRequest, setBonusDetails, userID]);\n\n  const RenderMetaScore = ({\n    meta\n  }) => {\n    return (\n      /*#__PURE__*/\n      // <WrapMetaScore>\n      //   <div className=\"bonus-title\">{bonus.title}</div>\n      //   <div className=\"bonus-description\">+ {meta.s4 || 0} 分</div>\n      //   <div className=\"bonus-description\">+ {meta.r2 || 0} 分</div>\n      // </WrapMetaScore>\n      React.createElement(WrapBonusPanel, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"bonus_title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 7\n        }\n      }, \"\\u52A0\\u5206\\u8A73\\u60C5\"), /*#__PURE__*/React.createElement(\"section\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 11\n        }\n      }, \"\\u968E\\u6BB5\\u56DB\"), \" \", /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 28\n        }\n      }, \"+\", meta.s4 || 0)), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }\n      }, \"Round 2\"), \" \", /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 32\n        }\n      }, \"+\", meta.r2 || 0))), /*#__PURE__*/React.createElement(Borderline, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 7\n        }\n      }))\n    );\n  };\n\n  if (needRequest && BonusDetails.length === 0) {\n    return /*#__PURE__*/React.createElement(WrapPanel, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Loading, {\n      color: \"#ffffff\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  return /*#__PURE__*/React.createElement(WrapPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 5\n    }\n  }, bonus.map(item => {\n    if (needRequest) {\n      // let isChecked = false;\n      let score = 0;\n\n      if (BonusDetails.length > 0) {\n        const bonusMatched = BonusDetails.find(detail => detail.metaKey.includes(item.metaKey)); // if (bonusMatched) {\n        //   isChecked = bonusMatched.score >= item.threshold;\n        //   score =\n        //   bonusMatched.score >= item.threshold\n        //       ? item.threshold\n        //       : bonusMatched.score;\n        // }\n      }\n\n      return /*#__PURE__*/React.createElement(RenderMission, {\n        key: item.title,\n        bonus: item,\n        score: score,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 13\n        }\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(RenderMetaScore, {\n      key: item.title,\n      bonus: item,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 16\n      }\n    });\n  }));\n});","map":{"version":3,"sources":["D:/17專案/客製化ui專案/2011-tw-xmas chris/vmo-frontend-2011-tw-xmas/packages/web/components/leaderboard/BonusPanel.tsx"],"names":["React","useContext","useEffect","useRef","memo","axios","WrapBonusPanel","WrapPanel","Borderline","Loading","getEventoryDetails","BonusPanelContext","RenderMission","bonus","score","title","condition","userID","meta","source","panelState","BonusDetails","setBonusDetails","needRequest","length","subKeys","current","CancelToken","cancelToken","token","containerID","then","result","detailList","data","forEach","item","metaKey","push","cancel","RenderMetaScore","s4","r2","map","bonusMatched","find","detail","includes"],"mappings":";AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,OAAOA,KAAP,IAAgBC,UAAhB,EAA4BC,SAA5B,EAAuCC,MAAvC,EAA+CC,IAA/C,QAA2D,OAA3D;AACA,OAAOC,KAAP,MAAyC,OAAzC;AACA,SAASC,cAAT,EAAsCC,SAAtC,EAAgDC,UAAhD,QAAkE,SAAlE;AACA,OAAOC,OAAP,MAAoB,iBAApB;AACA,SAASC,kBAAT,QAAmC,iDAAnC;AACA,SAASC,iBAAT,QAAkC,iCAAlC;;AAEA,MAAMC,aAAa,GAAG,CAAC;AAAEC,EAAAA,KAAF;AAASC,EAAAA;AAAT,CAAD,KAAsB;AAC1C,sBACE,oBAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA8BD,KAAK,CAACE,KAApC,CADF,eAEI;AAAK,IAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGD,KADH,WAFJ,CADF;AAQD,CATD;;AAWA,eAAeV,IAAI,CAAC,CAAC;AAAEY,EAAAA,SAAF;AAAaC,EAAAA,MAAb;AAAqBC,EAAAA,IAAI,GAAG;AAA5B,CAAD,KAAsC;AACxD,QAAMC,MAAM,GAAGhB,MAAM,EAArB;AACA,QAAMiB,UAAU,GAAGnB,UAAU,CAACU,iBAAD,CAA7B;AACA,QAAM;AAAEU,IAAAA,YAAF;AAAgBC,IAAAA;AAAhB,MAAoCF,UAA1C;AAEA,QAAM;AAAEG,IAAAA,WAAF;AAAeV,IAAAA;AAAf,MAAyBG,SAA/B;AAEAd,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIqB,WAAW,IAAIF,YAAY,CAACG,MAAb,KAAwB,CAA3C,EAA8C;AAC5C,YAAMC,OAAO,GAAGR,MAAhB;AACAE,MAAAA,MAAM,CAACO,OAAP,GAAiBrB,KAAK,CAACsB,WAAN,CAAkBR,MAAlB,EAAjB;AACA,YAAMS,WAAW,GAAGT,MAAM,CAACO,OAAP,CAAeG,KAAnC;AACAnB,MAAAA,kBAAkB,CAACM,SAAS,CAACc,WAAX,EAAwBL,OAAxB,EAAiCG,WAAjC,CAAlB,CAAgEG,IAAhE,CACEC,MAAM,IAAI;AACR,cAAMC,UAAU,GAAG,EAAnB;;AACA,YAAID,MAAM,IAAIA,MAAM,CAACE,IAArB,EAA2B;AACzBF,UAAAA,MAAM,CAACE,IAAP,CAAYC,OAAZ,CAAoBC,IAAI,IAAI;AAC1B,gBAAIA,IAAI,CAAClB,IAAL,IAAakB,IAAI,CAAClB,IAAL,CAAUmB,OAA3B,EACEJ,UAAU,CAACK,IAAX,CAAgB;AACdD,cAAAA,OAAO,EAAED,IAAI,CAAClB,IAAL,CAAUmB,OADL;AAEdvB,cAAAA,KAAK,EAAEsB,IAAI,CAACtB;AAFE,aAAhB;AAIH,WAND;AAOD,SARD,MAQO;AACLmB,UAAAA,UAAU,CAACK,IAAX,CAAgB;AACdD,YAAAA,OAAO,EAAE,EADK;AAEdvB,YAAAA,KAAK,EAAE;AAFO,WAAhB;AAID;;AAEDQ,QAAAA,eAAe,CAACW,UAAD,CAAf;AACD,OAnBH;AAqBD;;AACD,WAAO,MAAM;AACX,UAAId,MAAM,CAACO,OAAX,EAAoBP,MAAM,CAACO,OAAP,CAAea,MAAf;AACrB,KAFD;AAGD,GA9BQ,EA8BN,CACDvB,SAAS,CAACc,WADT,EAEDT,YAAY,CAACG,MAFZ,EAGDD,WAHC,EAIDD,eAJC,EAKDL,MALC,CA9BM,CAAT;;AAsCA,QAAMuB,eAAe,GAAG,CAAC;AAAEtB,IAAAA;AAAF,GAAD,KAAc;AACpC;AAAA;AACE;AACA;AACA;AACA;AACA;AACF,0BAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADF,oBACmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAQA,IAAI,CAACuB,EAAL,IAAW,CAAnB,CADnB,CADF,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,oBACuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAQvB,IAAI,CAACwB,EAAL,IAAW,CAAnB,CADvB,CAJF,CAFF,eAUE,oBAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAVF;AANA;AAmBD,GApBD;;AAsBA,MAAInB,WAAW,IAAIF,YAAY,CAACG,MAAb,KAAwB,CAA3C,EAA8C;AAC5C,wBACE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,OAAD;AAAS,MAAA,KAAK,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADF;AAKD;;AAED,sBACE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGX,KAAK,CAAC8B,GAAN,CAAUP,IAAI,IAAI;AACjB,QAAIb,WAAJ,EAAiB;AACf;AACA,UAAIT,KAAK,GAAG,CAAZ;;AACA,UAAIO,YAAY,CAACG,MAAb,GAAsB,CAA1B,EAA6B;AAC3B,cAAMoB,YAAY,GAAGvB,YAAY,CAACwB,IAAb,CAAkBC,MAAM,IAC3CA,MAAM,CAACT,OAAP,CAAeU,QAAf,CAAwBX,IAAI,CAACC,OAA7B,CADmB,CAArB,CAD2B,CAI3B;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;AACD,0BACE,oBAAC,aAAD;AACE,QAAA,GAAG,EAAED,IAAI,CAACrB,KADZ;AAEE,QAAA,KAAK,EAAEqB,IAFT;AAGE,QAAA,KAAK,EAAEtB,KAHT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAOD;;AACD,wBAAO,oBAAC,eAAD;AAAiB,MAAA,GAAG,EAAEsB,IAAI,CAACrB,KAA3B;AAAkC,MAAA,KAAK,EAAEqB,IAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAP;AACD,GAzBA,CADH,CADF;AA8BD,CAzGkB,CAAnB","sourcesContent":["// import React from 'react';\r\n\r\n// import { WrapBonusPanel, Borderline } from './style';\r\n\r\n// export default ({ meta }) => {\r\n//   return (\r\n//     <WrapBonusPanel>\r\n//       <div className=\"bonus_title\">加分詳情</div>\r\n//       <section>\r\n//         <div>\r\n//           <span>階段四</span> <span>+{meta.s4 || 0}</span>\r\n//         </div>\r\n//         <div>\r\n//           <span>Round 2</span> <span>+{meta.r2 || 0}</span>\r\n//         </div>\r\n//       </section>\r\n//       <Borderline />\r\n//     </WrapBonusPanel>\r\n//   );\r\n// };\r\n\r\n\r\nimport React, { useContext, useEffect, useRef, memo } from 'react';\r\nimport axios, { CancelTokenSource } from 'axios';\r\nimport { WrapBonusPanel,WrapMetaScore,WrapPanel,Borderline } from './style';\r\nimport Loading from '@vmo/ui/Loading';\r\nimport { getEventoryDetails } from '@vmo/share/services/leaderboardEventory.service';\r\nimport { BonusPanelContext } from '../../context/bonusPanelContext';\r\n\r\nconst RenderMission = ({ bonus, score }) => {\r\n  return (\r\n    <WrapBonusPanel>\r\n      <div className=\"bonus-title\">{bonus.title}</div>\r\n        <div className=\"bonus-score\">\r\n          {score}分\r\n        </div>\r\n    </WrapBonusPanel>\r\n  );\r\n};\r\n\r\nexport default memo(({ condition, userID, meta = {} }) => {\r\n  const source = useRef<CancelTokenSource>();\r\n  const panelState = useContext(BonusPanelContext);\r\n  const { BonusDetails, setBonusDetails } = panelState;\r\n\r\n  const { needRequest, bonus } = condition;\r\n\r\n  useEffect(() => {\r\n    if (needRequest && BonusDetails.length === 0) {\r\n      const subKeys = userID;\r\n      source.current = axios.CancelToken.source();\r\n      const cancelToken = source.current.token;\r\n      getEventoryDetails(condition.containerID, subKeys, cancelToken).then(\r\n        result => {\r\n          const detailList = [];\r\n          if (result && result.data) {\r\n            result.data.forEach(item => {\r\n              if (item.meta && item.meta.metaKey)\r\n                detailList.push({\r\n                  metaKey: item.meta.metaKey,\r\n                  score: item.score,\r\n                });\r\n            });\r\n          } else {\r\n            detailList.push({\r\n              metaKey: '',\r\n              score: 0,\r\n            });\r\n          }\r\n\r\n          setBonusDetails(detailList);\r\n        },\r\n      );\r\n    }\r\n    return () => {\r\n      if (source.current) source.current.cancel();\r\n    };\r\n  }, [\r\n    condition.containerID,\r\n    BonusDetails.length,\r\n    needRequest,\r\n    setBonusDetails,\r\n    userID,\r\n  ]);\r\n\r\n  const RenderMetaScore = ({ meta }) => {\r\n    return (\r\n      // <WrapMetaScore>\r\n      //   <div className=\"bonus-title\">{bonus.title}</div>\r\n      //   <div className=\"bonus-description\">+ {meta.s4 || 0} 分</div>\r\n      //   <div className=\"bonus-description\">+ {meta.r2 || 0} 分</div>\r\n      // </WrapMetaScore>\r\n    <WrapBonusPanel>\r\n      <div className=\"bonus_title\">加分詳情</div>\r\n      <section>\r\n        <div>\r\n          <span>階段四</span> <span>+{meta.s4 || 0}</span>\r\n        </div>\r\n        <div>\r\n          <span>Round 2</span> <span>+{meta.r2 || 0}</span>\r\n        </div>\r\n      </section>\r\n      <Borderline />\r\n    </WrapBonusPanel>\r\n    );\r\n  };\r\n\r\n  if (needRequest && BonusDetails.length === 0) {\r\n    return (\r\n      <WrapPanel>\r\n        <Loading color=\"#ffffff\" />\r\n      </WrapPanel>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <WrapPanel>\r\n      {bonus.map(item => {\r\n        if (needRequest) {\r\n          // let isChecked = false;\r\n          let score = 0;\r\n          if (BonusDetails.length > 0) {\r\n            const bonusMatched = BonusDetails.find(detail =>\r\n              detail.metaKey.includes(item.metaKey),\r\n            );\r\n            // if (bonusMatched) {\r\n            //   isChecked = bonusMatched.score >= item.threshold;\r\n            //   score =\r\n            //   bonusMatched.score >= item.threshold\r\n            //       ? item.threshold\r\n            //       : bonusMatched.score;\r\n            // }\r\n          }\r\n          return (\r\n            <RenderMission\r\n              key={item.title}\r\n              bonus={item}\r\n              score={score}\r\n            />\r\n          );\r\n        }\r\n        return <RenderMetaScore key={item.title} bonus={item} />;\r\n      })}\r\n    </WrapPanel>\r\n  );\r\n});\r\n\r\n"]},"metadata":{},"sourceType":"module"}